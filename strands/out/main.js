(()=>{var B=class{constructor(t,e){this._errorTypes={};this._positiveTypes={};this._infoTypes={};this._error=t=>{let e=document.createElement("aside");e.classList.add("aside","~critical","@low","mt-2","notification-error");let s="";window.lang&&(s=window.lang.strings("error")+":"),e.innerHTML=`<strong>${s}</strong> ${t}`;let o=document.createElement("span");return o.classList.add("button","~critical","@low","ml-4"),o.innerHTML='<i class="icon ri-close-line"></i>',o.onclick=()=>this._close(e),e.classList.add("animate-slide-in"),e.appendChild(o),e};this._positive=(t,e)=>{let s=document.createElement("aside");s.classList.add("aside","~positive","@low","mt-2","notification-positive"),s.innerHTML=`<strong>${t}</strong> ${e}`;let o=document.createElement("span");return o.classList.add("button","~positive","@low","ml-4"),o.innerHTML='<i class="icon ri-close-line"></i>',o.onclick=()=>this._close(s),s.classList.add("animate-slide-in"),s.appendChild(o),s};this._info=(t,e)=>{let s=document.createElement("aside");s.classList.add("aside","~info","@low","mt-2","notification-info"),s.innerHTML=`<strong>${t}</strong> ${e}`;let o=document.createElement("span");return o.classList.add("button","~info","@low","ml-4"),o.innerHTML='<i class="icon ri-close-line"></i>',o.onclick=()=>this._close(s),s.classList.add("animate-slide-in"),s.appendChild(o),s};this._close=t=>{t.classList.remove("animate-slide-in"),t.classList.add("animate-slide-out"),t.addEventListener(window.animationEvent,()=>{this._box.removeChild(t)},!1)};this.connectionError=()=>{this.customError("connectionError",window.lang.notif("errorConnection"))};this.customError=(t,e)=>{this._errorTypes[t]=this._errorTypes[t]||!1;let s=this._error(e);s.classList.add("error-"+t);let o=this._box.querySelector("aside.error-"+t);this._errorTypes[t]&&o!==void 0&&o!=null&&(this._box.removeChild(o),s.classList.add("animate-pulsate"),s.classList.remove("animate-slide-in")),this._box.appendChild(s),this._errorTypes[t]=!0,setTimeout(()=>{this._box.contains(s)&&(this._close(s),this._errorTypes[t]=!1)},this.timeout*1e3)};this.customPositive=(t,e,s)=>{this._positiveTypes[t]=this._positiveTypes[t]||!1;let o=this._positive(e,s);o.classList.add("positive-"+t);let i=this._box.querySelector("aside.positive-"+t);this._positiveTypes[t]&&i!==void 0&&i!=null&&(this._box.removeChild(i),o.classList.add("animate-pulsate"),o.classList.remove("animate-slide-in")),this._box.appendChild(o),this._positiveTypes[t]=!0,setTimeout(()=>{this._box.contains(o)&&(this._close(o),this._positiveTypes[t]=!1)},this.timeout*1e3)};this.customSuccess=(t,e)=>this.customPositive(t,(window.lang?window.lang.strings("success"):"Success")+":",e);this.customInfo=(t,e,s)=>{this._infoTypes[t]=this._infoTypes[t]||!1;let o=this._info(e,s);o.classList.add("info-"+t);let i=this._box.querySelector("aside.info-"+t);this._infoTypes[t]&&i!==void 0&&i!=null&&(this._box.removeChild(i),o.classList.add("animate-pulsate"),o.classList.remove("animate-slide-in")),this._box.appendChild(o),this._infoTypes[t]=!0,setTimeout(()=>{this._box.contains(o)&&(this._close(o),this._infoTypes[t]=!1)},this.timeout*1e3)};this._box=t,this.timeout=e||5}},F=()=>document.createElement("fakeElement").style.animation!==void 0?"animationend":"webkitAnimationEnd";function C(n,t=!0,e=!1){if(!n.classList.contains("loader")){n.classList.add("loader"),e&&n.classList.add("rel"),t&&n.classList.add("loader-sm");let s=document.createElement("span");s.classList.add("dot"),n.appendChild(s)}}function D(n,t=!0){if(n.classList.contains("loader")){n.classList.remove("loader"),n.classList.remove("loader-sm"),n.classList.remove("rel");let e=n.querySelector("span.dot");e&&e.remove()}}function v(n){let t=atob(n),e=Uint8Array.from(t,o=>o.codePointAt(0));return new TextDecoder().decode(e)}function w(n){let t=new TextEncoder().encode(n),e=String.fromCodePoint(...t);return btoa(e)}var O={printDate:"2024-05-24",id:-1,editor:"Harvey Tindall",spangram:"ALRIGHTY",clue:"(Down)load a game below to start.",startingBoard:["THIS-Y","ISNT-T","AREALH","BOARDG","LOAD-I","O-E--R","<N---L","OKAY?A"],solutions:["ALRIGHTY","THIS","ISNT","REAL","BOARD","LOAD","ONE","OKAY","BOAR","EAR","ALRIGHT","LONE","OK"],themeCoords:{THIS:[[0,0],[0,1],[0,2],[0,3]],ISNT:[[1,0],[1,1],[1,2],[1,3]],REAL:[[2,1],[2,2],[2,3],[2,4]],BOARD:[[3,0],[3,1],[3,2],[3,3],[3,4]],LOAD:[[4,0],[4,1],[4,2],[4,3]],ONE:[[5,0],[6,1],[5,2]],OKAY:[[7,0],[7,1],[7,2],[7,3]]}};var E=class{constructor(t,e=!1){this.close=t=>{if(!this.modal.classList.contains("block"))return;t&&t.preventDefault(),this.modal.classList.add("animate-fade-out"),this.modal.classList.remove("animate-fade-in");let e=this.modal,s=()=>{e.classList.remove("block"),e.classList.remove("animate-fade-out"),e.removeEventListener(window.animationEvent,s),document.dispatchEvent(this.closeEvent)};this.modal.addEventListener(window.animationEvent,s,!1)};this.show=()=>{this.modal.classList.add("block","animate-fade-in"),document.dispatchEvent(this.openEvent)};this.toggle=()=>{this.modal.classList.contains("animate-fade-in")?this.close():this.show()};this.asElement=()=>this.modal;this.modal=t,this.openEvent=new CustomEvent("modal-open-"+t.id),this.closeEvent=new CustomEvent("modal-close-"+t.id);let s=this.modal.querySelector("span.modal-close");s!==null&&(this.closeButton=s,this.closeButton.onclick=this.close),e||window.addEventListener("click",o=>{o.target==this.modal&&this.close()})}set onopen(t){document.addEventListener("modal-open-"+this.modal.id,t)}set onclose(t){document.addEventListener("modal-close-"+this.modal.id,t)}};var c=n=>`${n.uid} ${n.key}`;var U=()=>`PING
`,$=()=>`HELLO
`,N=n=>`HELLO ${c(n)}
`,W=(n,t="",e="")=>`NEWROOM ${c(n)} ${t}${e!=""?" "+e:""}
`,q=()=>`ROOMS
`,P=(n,t,e="")=>`JOIN ${c(n)} ${t}${e!=""?" "+e:""}
`,J=n=>`LEAVE ${c(n)}
`,j=(n,t)=>`SETBOARD ${c(n)} ${t}
`,Y=n=>`BOARD ${c(n)}
`,K=n=>`DLBOARD ${n}
`,X=()=>`BOARDSUMMARIES
`,z=(n,t,e)=>`GUESS ${c(n)} ${t} ${e}
`,V=n=>`ENDGUESS ${c(n)}
`,Q=n=>`HINT ${c(n)}
`,Z=n=>`TWORD ${n}
`,tt=n=>{let t="SPANGRAM";for(let e of n)t+=` ${e[0]},${e[1]}`;return t+=`
`,t},et=n=>{let t="CURRENTGUESS";for(let e of n)t+=` ${e[0]},${e[1]}`;return t+=`
`,t},st=n=>`WORDSTOHINT ${n}
`,ot=n=>`GETSTATE ${c(n)}
`,H=(n,t,e)=>`FORWARD ${c(n)} ${t.uid} ${e}
`;var S=class{constructor(t){this.room={rid:"",board:""};this._connected=!1;this._successFunc=()=>{};this._failFunc=()=>{};this._endFunc=()=>{};this._invalidFunc=()=>{};this._roomJoinFunc=t=>{};this._newRoomFunc=t=>{};this.onGuess=(t,e)=>{console.log("Guessed",t,e)};this.onEndGuess=()=>{console.log("Guess ended!")};this.onHintUsed=()=>{console.log("Hint used!")};this.onHostPromotion=()=>{console.log("Became host.")};this.onBoardStateThemeWord=t=>{console.log("word:",t)};this.onBoardStateSpangram=t=>{console.log("Spangram coords:",t)};this.onBoardStateWordsToGetHint=t=>{console.log("Words to get hint:",t)};this.onPlayerJoined=t=>{console.log("Player",t,"joined.")};this.onPlayerLeft=t=>{console.log("Player",t,"left")};this.onBoardSummaryAdded=t=>{console.log("date",t.date,"clue",t.clue,"editor",t.editor)};this.onBoardReceived=()=>{};this._callBacks={};this.roomList={};this.connect=(t=()=>{})=>{};this._ping=()=>{this._ws.send(U()),this._connected&&setTimeout(this._ping,2*6e4)};this.loginOrNewUser=(t,e,s=()=>{})=>{this.cmdHelloExistingUser(t,e,()=>{this.user.uid==""?(console.log("Creds invalid, making new ones"),this.cmdHello(()=>{s()})):s()})};this.cmdHelloExistingUser=(t,e,s=()=>{})=>{this._callBacks.HELLO=s,this._invalidFunc=s,this.user={uid:"",key:"",nick:"",room:""};let o={uid:t,key:e,nick:"",room:""};this._ws.send(N(o))};this.cmdHello=(t=()=>{})=>{this._callBacks.HELLO=t,this._ws.send($())};this.respHello=t=>{this.user={uid:t[1],key:t[2],nick:"",room:""},console.log("Logged in as",this.user),this._callBacks.HELLO()};this.cmdNewRoom=(t="",e="",s=o=>{})=>{this._newRoomFunc=s,this.room={password:e},this._ws.send(W(this.user,w(t),w(e)))};this.respNewRoom=t=>{console.log(`Created new room "${t[1]}"`),this.cmdJoinRoom(t[1],this.room.password,e=>{this.host=!0,this._newRoomFunc(e)})};this.cmdJoinRoom=(t,e="",s=()=>{})=>{this.host=!1,this._roomJoinFunc=s,this._roomToJoin=t,this.room.rid="",this.room.board="",this.room.password=e,this._successFunc=this.respJoinRoom,this._invalidFunc=()=>{this._roomJoinFunc(!1)},this._failFunc=this._invalidFunc,this._ws.send(P(this.user,t,w(e)))};this.respJoinRoom=()=>{this.user.room=this._roomToJoin;let t="";this._roomToJoin in this.roomList&&(t=this.roomList[this._roomToJoin].nick),this.room={rid:this._roomToJoin,board:"",nick:t,password:this.room.password},console.log(`Joined room "${this.user.room}"`),this._roomJoinFunc(!0)};this.cmdLeaveRoom=(t=()=>{})=>{this._successFunc=()=>{console.log("left room."),this.room={rid:"",board:"",nick:"",password:""},t()},this._ws.send(J(this.user))};this.cmdListRooms=(t=()=>{})=>{this._callBacks.LISTROOMS=t,this._ws.send(q()),this.roomList={},this._endFunc=()=>{console.log("Rooms:",this.roomList),this._callBacks.LISTROOMS()}};this.respListRooms=t=>{let e="",s=!1;if(t.length==4){let o=t[3].split(" ",2);e=o[0],s=o.length>1&&o[1]=="PASSWORD"}else t.length==5&&(e=t[3],s=t[4]=="PASSWORD");this.roomList[t[1]]={playerCount:+t[2],nick:e=="NONE"?"":v(e),password:s}};this.cmdSetBoard=(t,e=()=>{})=>{this.room.rid!=""&&(this._callBacks.SETBOARD=e,this._ws.send(j(this.user,w(t))),this._successFunc=()=>{console.log("Sent board."),this._callBacks.SETBOARD()})};this.cmdGetBoard=(t=()=>{})=>{this.room.rid!=""&&(this._callBacks.GETBOARD=()=>{this.onBoardReceived(),t()},this._ws.send(Y(this.user)),this._failFunc=()=>{this.onBoardReceived(),t()})};this.respGetBoard=t=>{this.room.board=v(t[1]),this._callBacks.GETBOARD()};this.cmdGuess=(t,e)=>{this.room.rid!=""&&this._ws.send(z(this.user,t,e))};this.cmdEndGuess=()=>{this.room.rid!=""&&this._ws.send(V(this.user))};this.respGuess=t=>{let e=+t[1],s=+t[2];this.onGuess(e,s)};this.respEndGuess=()=>this.onEndGuess();this.cmdHint=()=>{this.room.rid!=""&&this._ws.send(Q(this.user))};this.respHint=()=>this.onHintUsed();this.cmdGetState=()=>{this.room.rid!=""&&this._ws.send(ot(this.user))};this.cmdDownloadBoard=(t,e=s=>{})=>{this._callBacks.GETBOARD=()=>{e(this.room.board)},this._failFunc=()=>{e("")},this._ws.send(K(t))};this.cmdBoardSummaries=()=>{this._ws.send(X())};this.respBoardSummaries=t=>{let e={date:t[1],clue:v(t[2]),editor:v(t[3])};this.onBoardSummaryAdded(e)};this.respReqStateFromHost=t=>{let e={uid:t[1],key:"",nick:"",room:""},s=this.onBoardRequest();for(let o of s.themeWordsFound)this._ws.send(H(this.user,e,Z(o)));s.spangramFound&&this._ws.send(H(this.user,e,tt(s.spangramCoords))),s.currentGuess.length!=0&&this._ws.send(H(this.user,e,et(s.currentGuess))),this._ws.send(H(this.user,e,st(s.wordsToGetHint)))};this.processIncomingCoords=t=>{let e=[];for(let o=1;o<t.length;o++)if(o==t.length-1){let i=t[o].split(" ");e=e.concat(i)}else e.push(t[o]);let s=[];for(let o=0;o<e.length;o++){let i=e[o].split(",");s.push([+i[0],+i[1]])}return s};this.processSpangramCoords=t=>{let e=this.processIncomingCoords(t);this.onBoardStateSpangram(e)};this.processCurrentGuess=t=>{let e=this.processIncomingCoords(t),s=0,o=()=>{this.onGuess(e[s][1],e[s][0]),s++,s!=e.length&&setTimeout(o,M)};o()};this._url=t,window.cli=this}},y=class{constructor(t,e,s,o,i,r,d,a,m){this.onJoinRoom=(t=!1)=>{if(!t){window.notif.customError("failedJoin","Couldn't join room.");return}this.cli.cmdGetBoard();let e=this.urlFromRID(this.cli.room.rid,w(this.cli.room.password));window.history.pushState({},"",e),this._modal.close()};this.onLeaveRoom=()=>{window.history.pushState({},"",this.getBaseURL()),this._modal.close(),window.notif.customSuccess("roomLeft","Room left.")};this.ridFromURL=()=>{let e=new URLSearchParams(window.location.search).get("room");return e||""};this.passwordFromURL=()=>{let e=new URLSearchParams(window.location.search).get("password");return e?v(e):""};this.urlFromRID=(t,e="")=>{let s=window.location.href.split("?room=")[0];return s.at(s.length-1)!="/"&&(s+="/"),s+="?room="+t,e!=""&&(s+="&password="+e),s};this.getBaseURL=()=>window.location.href.split("?room=")[0];this.connect=()=>{let t=localStorage.getItem("uid"),e=localStorage.getItem("key");this.cli.connect(()=>this.cli.loginOrNewUser(t,e,()=>{localStorage.setItem("uid",this.cli.user.uid),localStorage.setItem("key",this.cli.user.key);let s=this.ridFromURL(),o=this.passwordFromURL();s!=""&&this.cli.cmdJoinRoom(s,o,this.onJoinRoom)}))};this.cli=t,this._boardLoader=m,this.cli.onHostPromotion=()=>{window.notif.customInfo("hostPromotion","","You were made host.")},this.cli.onPlayerJoined=h=>{window.notif.customInfo("playerJoined","",`Player "${h}" joined.`)},this.cli.onPlayerLeft=h=>{window.notif.customInfo("playerJoined","",`Player "${h}" left.`)},this.cli.onBoardReceived=()=>{this.cli.room.board==""&&this.cli.host?this.cli.cmdSetBoard(this.board):this.cli.host||this._boardLoader(JSON.parse(this.cli.room.board)),this.cli.host||this.cli.cmdGetState()},this._modal=new E(e,!1)}};var R=class{constructor(t,e,s,o,i,r,d,a){this.appendSummary=t=>{this._summaries.push(t);let e=document.createElement("div");e.classList.add("card","~neutral","dark:~d_neutral","@low","flex","flex-col","items-center","gap-2"),e.innerHTML=`
            <div class="support">${t.date}</div>
            <div class="font-bold text-xl text-center handwriting">${t.clue}</div>
            <div class="text-center" title="Editor: ${t.editor}">
                ${t.editor}
            </div>
            <button class="button ~info dark:~d_info @high download-board">Download</button>
        `;let s=e.querySelector("button.download-board");s.onclick=()=>{C(s),this._downloadFunc(t.date,o=>{D(s),this._loadFunc(o)})},this._boardList.appendChild(e)};this._fileButton=e,this._nytButton=s,this._nytSpecific=o,this._modal=new E(t,!1),this._boardList=i,this._getBoardsFunc=r,this._downloadFunc=d,this._loadFunc=l=>{l==""?window.notif.customError("failedDownload","Couldn't download board."):window.notif.customSuccess("boardDownloaded","Board downloaded."),a(l),this._modal.close()},this._fileButton.onclick=()=>{let l=document.createElement("input");l.type="file",l.onchange=p=>{let _=new FileReader;_.readAsText(p.target.files[0],"UTF-8"),_.onload=g=>{let f=g.target.result;this._loadFunc(f)}},l.click()},document.getElementById("load-nyt-button").onclick=()=>{var l=prompt("Date (leave empty if you want today's Strand)"),p="";if(!l||l.trim()===""){var _=new Date,g=_.getFullYear(),f=(_.getMonth()+1).toString().padStart(2,"0"),L=_.getDate().toString().padStart(2,"0");p=`${g}-${f}-${L}`}else{var u=new Date(l);if(isNaN(u.getTime())){alert("Invalid date format. Please enter a valid date in yyyy-mm-dd format.");return}else{var g=u.getFullYear(),f=(u.getMonth()+1).toString().padStart(2,"0"),L=u.getDate().toString().padStart(2,"0");p=`${g}-${f}-${L}`}}var A=`https://api.codetabs.com/v1/proxy/?quest=https://www.nytimes.com/svc/strands/v2/${p}.json`;fetch(A).then(T=>T.json()).then(T=>{this._loadFunc(JSON.stringify(T))}).catch(T=>{console.error("Error fetching data:",T)})},document.getElementById("load-today-nyt-button").onclick=()=>{var l=new Date,p=l.getFullYear(),_=(l.getMonth()+1).toString().padStart(2,"0"),g=l.getDate().toString().padStart(2,"0"),f=`${p}-${_}-${g}`,L=`https://api.codetabs.com/v1/proxy/?quest=https://www.nytimes.com/svc/strands/v2/${f}.json`;fetch(L).then(u=>u.json()).then(u=>{this._loadFunc(JSON.stringify(u))}).catch(u=>{console.error("Error fetching data:",u)})},this._nytButton.onclick=()=>{this._summaries=[],this._boardList.textContent="",this._getBoardsFunc(),this._modal.show()};let m=this._nytSpecific.querySelector("button"),h=this._nytSpecific.querySelector("input"),G=()=>{h.value!=""&&(C(m),this._downloadFunc(h.value,l=>{D(m),this._loadFunc(l)}))};m.onclick=G,h.onkeyup=l=>{l.key=="Enter"&&G()}}};window.animationEvent=F();window.notif=new B(document.getElementById("notification-box"),5);var b="_ _ _ _ _ _",it="Get hint",nt=2,rt=3,k="animate-select",at=300,M=40,I=class{constructor(t,e="animate-ping2",s=1800){this.msg=(t,e="",s=-1)=>{s==-1&&(s=this._timeout),this._el.textContent=t,this._el.onanimationend=()=>{this._el.textContent="",this._el.classList.remove(this._animate)},this._el.style.cssText=`color: ${e}; animation-duration: ${s}ms !important;`,this._el.classList.add(this._animate)};this._el=t,this._timeout=s,this._animate=e}};function dt(n,t){return n[0]==t[0]&&n[1]==t[1]}function lt(n,t,e){let s=[];for(let o=0;o<t.length;o++)n.at(o)==e&&s.push(t[o]);return s}var x=class{constructor(t,e,s,o,i,r,d){this._formingGuess=!1;this._inHover=!1;this._mouseDown=!1;this._selected=[];this._clickStart=[-1,-1];this._clickCurrent=[-1,-1];this.wordsToGetHint=3;this._wordsRemainingForHint=-1;this._wordsFound=[];this._themeWordsFound=[];this._spangramFound=!1;this._spangramCoords=[];this._themeWordCount=0;this.changeBoard=t=>{this._reloadBoard(t),this.render()};this.randTransform=()=>`skew(${this.randAngle(nt)}deg) rotate(${this.randAngle(rt)}deg)`;this.randEllipse=()=>`s${Math.floor(Math.random()*8)+1}`;this.resetChar=(t,e,s)=>{let o=`<div style="transform: ${this.randTransform()};" class="inner z-10 w-full h-full flex justify-center items-center ${this.randEllipse()}`;t.classList.contains("valid")&&(o+=" valid"),t.classList.contains("selected")&&(o+=" selected"),t.classList.contains("hinted")&&(o+=" hinted"),t.classList.contains("spangram")&&(o+=" spangram"),o+=`"><div class="relative text-center">${this._board.startingBoard[s].at(e)}</div></div>`,t.innerHTML=o};this.render=()=>{this._el.textContent="",this._guess.textContent=b;for(let t=0;t<this._h;t++)this._grid.push([]);for(let t=0;t<this._w;t++){let e=document.createElement("div");e.classList.add("flex","flex-col","justify-between");for(let s=0;s<this._h;s++){let o=this._board.startingBoard[s].at(t),i=document.createElement("div");i.classList.add("m-2");let r=document.createElement("div");r.setAttribute("data-x",""+t),r.setAttribute("data-y",""+s),r.classList.add("char","font-bold","w-8","h-8"),r.innerHTML=`<div class="inner z-10 w-full h-full flex justify-center items-center"><div class="relative text-center">${o}</div></div>`,i.addEventListener("pointerdown",()=>this._onMouseDown(r,t,s)),i.addEventListener("pointermove",d=>this._onMouseMove(d,r,t,s)),i.appendChild(r),e.appendChild(i),this._grid[s].push(r)}this._el.appendChild(e)}document.addEventListener("pointerup",this._onMouseUp),this._clue.textContent=this._board.clue,this.updateWordCount()};this._onMouseDown=(t,e,s)=>{this._mouseDown=!0,this._inHover=!1,this._formingGuess=!0,this._clickStart=[e,s],this._clickCurrent=[e,s],this._addToGuess(t,e,s,!1,!1)};this._onMouseMove=(t,e,s,o)=>{if(this._clickStart[0]==s&&this._clickStart[1]==o){let i=document.elementFromPoint(t.clientX,t.clientY);if(i.hasAttribute("data-x")||(i.parentElement.hasAttribute("data-x")?i=i.parentElement:i.childElementCount!=0&&i.children[0].hasAttribute("data-x")&&(i=i.children[0])),!i.hasAttribute("data-x"))return;s=+i.getAttribute("data-x"),o=+i.getAttribute("data-y"),e=i}!this._mouseDown||!this._formingGuess||this._clickCurrent[0]==s&&this._clickCurrent[1]==o||(this._clickCurrent=[s,o],(this._clickStart[0]!=s||this._clickStart[1]!=o)&&(this._inHover=!0,this._addToGuess(e,s,o,!1,!0)))};this._onMouseUp=()=>{if(!this._formingGuess)return;let t=this._clickCurrent[0],e=this._clickCurrent[1],s=this._grid[e][t];this._mouseDown=!1,this._inHover&&this._addToGuess(s,t,e,!0,!0)};this._collectGuess=()=>{let t="";for(let e=0;e<this._selected.length;e++)t+=this._board.startingBoard[this._selected[e][0]][this._selected[e][1]];return t};this._endGuess=(t=!1)=>{if(t||this._m.cli.cmdEndGuess(),this._formingGuess=!1,this._inHover=!1,this._selected.length==1)return;let e=this._collectGuess(),s=this.validateGuess(e);if(s==1){let o=!1;this._wordsFound.includes(e)?(this._mb.msg("Already done"),o=!0):(this._wordsFound.push(e),this._wordsRemainingForHint-=1),this._clear(!0,!1,o),this.updateWordCount()}else s==2?(this._mb.msg("Nice!","var(--color-valid)"),this.selectThemeWordByCoords(e,this._selected)):s==3?(this._mb.msg("Spangram!","var(--color-spangram)"),this.selectSpangramByCoords(this._selected)):this._clear(!0,!1,!0)};this.animateSelected=t=>{let e=t.querySelector(".inner");setTimeout(()=>{e.classList.remove(k)},at),e.classList.add(k)};this.selectThemeWordByCoords=(t,e)=>{this._themeWordsFound.push(t),this.addClassByCoords(e,"valid",this.updateWordCount)};this.selectSpangramByCoords=t=>{this._spangramFound=!0,this._spangramCoords=t,this.addClassByCoords(t,"spangram")};this.addClassByCoords=(t,e,s=()=>{})=>{let o=0,i=()=>{let r=this._grid[t[o][0]][t[o][1]];this.addClass(r,e),o!=0&&this.addConnector(r,t[o],t[o-1]),this.animateSelected(r),o++,o!=t.length?setTimeout(i,M):(this._clear(!0,!0),s())};i()};this.updateWordCount=()=>{this._themeWordsFound.length==this._themeWordCount&&this._spangramFound?this._foundText.textContent="You win!":this._foundText.textContent=`${this._themeWordsFound.length}/${this._themeWordCount} theme words found.`;let t=this.wordsToGetHint-(this._wordsRemainingForHint<0?0:this._wordsRemainingForHint);t=t/this.wordsToGetHint*100,this._hintButton.disabled=this._wordsRemainingForHint>0||this._themeWordsFound.length==this._themeWordCount;let e=it;this._hintButton.title="",this._wordsRemainingForHint>0?(this._hintButton.title=`${this._wordsRemainingForHint} word${this._wordsRemainingForHint!=1?"s":""} remaining`,this._hintButton.disabled=!0):this._hintButton.disabled=!1;let s=this._hintButton.querySelector(".progress"),o=this._hintButton.querySelector(".gethint");s.style.width=`${t}%`,o.textContent=e};this.renderGuess=(t=!1)=>{if(this._selected.length==0)if(t&&this._guess.textContent!=b){let e=document.createElement("div");e.classList.add("animate-nod"),e.onanimationend=()=>{e.classList.remove("animate-nod"),e.onanimationend=()=>{},setTimeout(()=>{this._guess.innerHTML=`<div class="animate-slide-up">${b}</div>`},M)},e.textContent=this._guess.textContent,this._guess.replaceChildren(e)}else this._guess.innerHTML=`<div class="animate-slide-up">${b}</div>`;else if(this._selected.length==1){let e=this._collectGuess();this._guess.innerHTML=`<div class="animate-slide-up">${e}</div>`}else{let e=this._guess.textContent,s=this._collectGuess(),o=s.length-e.length;if(console.log("diff:",o),e==b)this._guess.textContent=s;else if(o>0){this._guess.textContent=s.substring(0,s.length-o);let i=0,r=()=>{let d=document.createElement("div");d.classList.add("animate-slide-up"),d.textContent=s.at(s.length-1-i),this._guess.appendChild(d),i++,i<o&&setTimeout(r,50)};r()}else o<0&&(this._guess.textContent=s)}};this._useHint=(t=!1)=>{t||this._m.cli.cmdHint();let e="";for(let s in this._board.themeCoords)if(!this._themeWordsFound.includes(s)){e=s;break}for(let s of this._board.themeCoords[e])this.addClass(this._grid[s[0]][s[1]],"hinted");this._wordsRemainingForHint=this.wordsToGetHint,this.updateWordCount()};this._el=t,this._clue=e,this._guess=s,this._mb=new I(r),this._foundText=o,this._hintButton=i,this._hintButton.innerHTML=`
        <div class="progress transition-width" style="width: 0%;"></div>
        <div class="mix-blend-difference text-slate-50 gethint"></div>
        `,this._hintButton.onclick=()=>this._useHint(!1),this._wordsRemainingForHint=this.wordsToGetHint,this._m=new y(new S("ws://0.0.0.0:8802"),document.getElementById("modal-rooms"),document.getElementById("room-list"),document.getElementById("room-code"),document.getElementById("rooms-button"),document.getElementById("copy-room-link"),document.getElementById("new-room"),document.getElementById("new-room-inputs"),a=>{this._reloadBoard(a),this.render()}),this._m.cli.onGuess=(a,m)=>{let h=this._grid[m][a];this._addToGuess(h,a,m,!1,!1,!0)},this._m.cli.onEndGuess=()=>{let a=this._endGuess(!0);this.renderGuess(!a)},this._m.cli.onHintUsed=()=>this._useHint(!0),this._m.cli.onBoardRequest=()=>({themeWordsFound:this._themeWordsFound,spangramFound:this._spangramFound,spangramCoords:this._spangramCoords,wordsToGetHint:this._wordsRemainingForHint,currentGuess:this._selected}),this._m.cli.onBoardStateThemeWord=a=>{this.selectThemeWordByCoords(a,this._board.themeCoords[a])},this._m.cli.onBoardStateSpangram=a=>{this.selectSpangramByCoords(a)},this._m.cli.onBoardStateWordsToGetHint=a=>{this._wordsRemainingForHint=a,this.updateWordCount()},this._bl=new R(document.getElementById("modal-nyt"),document.getElementById("load-file"),document.getElementById("load-nyt"),document.getElementById("nyt-specific"),document.getElementById("board-list"),this._m.cli.cmdBoardSummaries,this._m.cli.cmdDownloadBoard,a=>{let m=JSON.parse(a);this.changeBoard(m),this._m.cli.cmdSetBoard(a)}),this._m.cli.onBoardSummaryAdded=this._bl.appendSummary,this._reloadBoard(d),this.render(),this._m.connect()}_reloadBoard(t){this._board=t,this._themeWordCount=Object.keys(this._board.themeCoords).length,this._w=this._board.startingBoard[0].length,this._h=this._board.startingBoard.length,this._grid=[],this._selected=[],this._formingGuess=!1,this._inHover=!1,this._mouseDown=!1,this._selected=[],this._clickStart=[-1,-1],this._clickCurrent=[-1,-1],this._wordsRemainingForHint=this.wordsToGetHint,this._wordsFound=[],this._themeWordsFound=[],this._spangramFound=!1,this._spangramCoords=[],this._m.board=JSON.stringify(this._board)}randAngle(t){return(Math.random()-.5)*2*t}addClass(t,e){t.classList.add(e);let s=t.querySelector(".inner");s.classList.add(e,this.randEllipse()),s.style.transform=this.randTransform()}rmClass(t,e){t.classList.remove(e),t.querySelector(".inner").classList.remove(e)}_addToGuess(t,e,s,o,i,r=!1){if(t.classList.contains("valid")||t.classList.contains("spangram"))return;r||this._m.cli.cmdGuess(e,s);let d=this.validNextChar(t,e,s);d==2||o?r||this._endGuess(r):d==0?this._deselect(t,e,s,!i):d==-1?(this._clear(),this.append(e,s,t)):d==1&&this.append(e,s,t)}_deselect(t,e,s,o=!0){let i=[],r=!1;for(let d=0;d<this._selected.length;d++){let a=this._selected[d];o&&!r&&a[0]==s&&a[1]==e&&(r=!0),r?(this.rmClass(this._grid[a[0]][a[1]],"selected"),this.resetChar(this._grid[a[0]][a[1]],a[1],a[0])):i.push(a),!o&&!r&&a[0]==s&&a[1]==e&&(r=!0)}this._selected=i,this.renderGuess()}_clear(t=!0,e=!1,s=!1){for(let o=0;o<this._selected.length;o++){let i=this._selected[o];this.rmClass(this._grid[i[0]][i[1]],"selected"),t||this.rmClass(this._grid[i[0]][i[1]],"hinted"),e||this.resetChar(this._grid[i[0]][i[1]],i[1],i[0])}this._selected=[],this.renderGuess(s)}validNextChar(t,e,s){if(this._selected.length==0)return 1;let o=this._selected[this._selected.length-1];for(let r=0;r<this._selected.length;r++)if(this._selected[r][0]==s&&this._selected[r][1]==e)return r==this._selected.length-1?2:0;let i=!1;for(let r=-1;r<=1;r++)for(let d=-1;d<=1;d++)if(o[0]+r==s&&o[1]+d==e)return 1;return-1}validateGuess(t){let e=0;if(this._board.solutions.includes(t)&&(e+=1),this._board.spangram==t)return e=3,e;if(e==0)return e;if(t in this._board.themeCoords){let s=this._board.themeCoords[t],o=!0;for(let i=0;i<s.length;i++){let r=lt(t,s,t.at(i)),d=!1;for(let a=0;a<r.length;a++)if(dt(s[i],r[a])){d=!0;break}if(!d){o=!1;break}}o&&(e+=1)}return e}addConnector(t,e,s){let o=e[0]-s[0],i=e[1]-s[1],r=document.createElement("div");r.classList.add("connector");let d="";o>0?d+="u":o<0&&(d+="d"),i>0?d+="l":i<0&&(d+="r"),d!=""&&r.classList.add(d),this.resetChar(t,e[1],e[0]),t.appendChild(r)}append(t,e,s){let o=this._selected.length>0;this._selected.push([e,t]),this.addClass(s,"selected"),o&&this.addConnector(s,[e,t],this._selected[this._selected.length-2]),this.animateSelected(s),this.renderGuess()}},Ct=new x(document.getElementById("board"),document.getElementById("clue"),document.getElementById("guess"),document.getElementById("found-text"),document.getElementById("hint-button"),document.getElementById("messagebox"),O);})();
//# sourceMappingURL=main.js.map
